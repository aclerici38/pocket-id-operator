{{- range .Values.users }}
---
apiVersion: pocketid.internal/v1alpha1
kind: PocketIDUser
metadata:
  name: {{ .name }}
  namespace: {{ $.Release.Namespace }}
  labels:
    app.kubernetes.io/name: pocket-id-user
    app.kubernetes.io/instance: {{ .name }}
    app.kubernetes.io/managed-by: {{ $.Release.Service }}
    helm.sh/chart: {{ include "chart.name" $ }}
    {{- with .labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  {{- if .spec }}
  {{- toYaml .spec | nindent 2 }}
  {{- else }}
  {{- $specFields := omit . "name" "labels" "annotations" }}
  {{- toYaml $specFields | nindent 2 }}
  {{- end }}
{{- end }}
